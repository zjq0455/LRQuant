sorted_kurt = {0.02096672136220734: '24mlp.up_proj', 0.026070663498454216: '22mlp.up_proj', 0.026151729884150043: '25mlp.up_proj', 0.029466900689183895: '23mlp.up_proj', 0.030696840246880353: '26mlp.up_proj', 0.03173594348243025: '21mlp.up_proj', 0.03293751666766287: '27mlp.up_proj', 0.037644738477705: '20mlp.up_proj', 0.045221148790187016: '22mlp.down_proj', 0.045774527398766196: '28mlp.up_proj', 0.04753815202167644: '18mlp.up_proj', 0.05398357984897961: '17mlp.up_proj', 0.06439268315669677: '2mlp.up_proj', 0.0757519740562933: '12mlp.up_proj', 0.07692631709511977: '19mlp.up_proj', 0.07732927133231815: '20self_attn.v_proj', 0.07960574558775058: '16mlp.up_proj', 0.08253144500009446: '25self_attn.v_proj', 0.08591864636608859: '7mlp.up_proj', 0.0875280255068498: '24self_attn.v_proj', 0.08838672097505595: '14mlp.up_proj', 0.09141451415031554: '21self_attn.v_proj', 0.09344239470000959: '26mlp.down_proj', 0.09416433004200675: '10mlp.up_proj', 0.09420727397064432: '27self_attn.v_proj', 0.09970998218644755: '13mlp.up_proj', 0.10186981503229475: '23self_attn.v_proj', 0.10289971635381123: '22self_attn.v_proj', 0.10315499579797693: '4mlp.up_proj', 0.10360805801621176: '15mlp.up_proj', 0.10748665074720876: '5mlp.up_proj', 0.11035153914889628: '6mlp.up_proj', 0.1136330829660479: '29self_attn.v_proj', 0.11512561508148877: '11mlp.up_proj', 0.1153095541552398: '3mlp.up_proj', 0.12290612284217017: '4self_attn.v_proj', 0.12578093703229776: '0mlp.up_proj', 0.13173803184508737: '17self_attn.v_proj', 0.13843906699112463: '9mlp.up_proj', 0.13933320374399027: '24mlp.down_proj', 0.1396861815281687: '18self_attn.v_proj', 0.14310082132413315: '8mlp.up_proj', 0.14792068350095233: '19self_attn.v_proj', 0.14994794914770315: '27mlp.down_proj', 0.15109458831782963: '30self_attn.v_proj', 0.15222507587639322: '23mlp.gate_proj', 0.15623756263924005: '28self_attn.v_proj', 0.15995790768457585: '24mlp.gate_proj', 0.16671253430768518: '5self_attn.v_proj', 0.16980774076199356: '15self_attn.v_proj', 0.17049487330157653: '2self_attn.v_proj', 0.17324317397773825: '16self_attn.v_proj', 0.17460190803072795: '26self_attn.v_proj', 0.1997543042302996: '22mlp.gate_proj', 0.21013766614548768: '3self_attn.v_proj', 0.21263582737689424: '21mlp.down_proj', 0.2140774706633204: '25mlp.gate_proj', 0.22078926688404366: '14self_attn.v_proj', 0.2213640681912059: '10self_attn.v_proj', 0.2245501145016311: '8self_attn.v_proj', 0.2252613589641217: '21mlp.gate_proj', 0.24058842202934994: '20mlp.gate_proj', 0.2409191655433962: '14mlp.down_proj', 0.24094505488519502: '13self_attn.v_proj', 0.25279501976742313: '2mlp.gate_proj', 0.25456664143893715: '9self_attn.v_proj', 0.25765131113272766: '25mlp.down_proj', 0.25883385059476893: '26mlp.gate_proj', 0.26901036799876366: '3mlp.gate_proj', 0.29169993537526206: '12mlp.down_proj', 0.29171961799213575: '12self_attn.v_proj', 0.30183294977458086: '6self_attn.v_proj', 0.3059414349857956: '19mlp.gate_proj', 0.3076264134488431: '16mlp.down_proj', 0.3132728389187305: '5mlp.gate_proj', 0.3207023327508245: '11self_attn.v_proj', 0.32561109364888674: '28mlp.down_proj', 0.35016806905977127: '19mlp.down_proj', 0.3545820598154399: '7self_attn.v_proj', 0.35622878060048846: '6mlp.gate_proj', 0.35716620468240334: '27mlp.gate_proj', 0.3635017796142108: '18mlp.gate_proj', 0.3662009159295945: '4mlp.gate_proj', 0.3796722090742528: '17mlp.gate_proj', 0.38547653869000253: '7mlp.gate_proj', 0.3917166195373265: '8mlp.gate_proj', 0.3965450154438708: '29mlp.up_proj', 0.4122678120212928: '28mlp.gate_proj', 0.41399610775645934: '25self_attn.o_proj', 0.4231637956140508: '31self_attn.v_proj', 0.44475613141199766: '1mlp.up_proj', 0.46356766419176454: '9mlp.gate_proj', 0.46764215608778326: '17mlp.down_proj', 0.47087722889433925: '18mlp.down_proj', 0.47211347626053035: '16mlp.gate_proj', 0.49298781371981315: '13mlp.gate_proj', 0.495786797250684: '15mlp.gate_proj', 0.5000946352030269: '2mlp.down_proj', 0.5031316078707673: '5mlp.down_proj', 0.5157555990507983: '14mlp.gate_proj', 0.5221862239656132: '3mlp.down_proj', 0.5231071621054237: '12mlp.gate_proj', 0.5343563483836373: '27self_attn.k_proj', 0.5472614262793738: '29mlp.down_proj', 0.5530041249449695: '11mlp.down_proj', 0.5542677087714925: '20mlp.down_proj', 0.5596160792985456: '15mlp.down_proj', 0.5786700386051513: '11mlp.gate_proj', 0.5969066369466294: '31mlp.gate_proj', 0.6052061299910871: '29mlp.gate_proj', 0.6072720146683652: '9mlp.down_proj', 0.6335260007037236: '10mlp.down_proj', 0.6398775576866766: '7mlp.down_proj', 0.6473591384996822: '13mlp.down_proj', 0.6487149038625772: '8mlp.down_proj', 0.6519259596288598: '30self_attn.k_proj', 0.6590828967628171: '10mlp.gate_proj', 0.6613479302235752: '23mlp.down_proj', 0.6766909225129805: '6mlp.down_proj', 0.7013362450844207: '28self_attn.k_proj', 0.7149706306649519: '31mlp.up_proj', 0.7510075058038539: '23self_attn.k_proj', 0.8157164807439541: '28self_attn.o_proj', 0.8281150656487992: '25self_attn.k_proj', 0.8526861313648708: '18self_attn.k_proj', 0.8557014360895479: '27self_attn.o_proj', 0.8562861685873253: '22self_attn.k_proj', 0.9410243132303155: '0mlp.down_proj', 0.9507138760715965: '4mlp.down_proj', 0.9508775395403659: '26self_attn.k_proj', 0.9534432721176596: '19self_attn.k_proj', 0.9551189681736383: '29self_attn.k_proj', 0.9618297565651868: '16self_attn.o_proj', 0.9620507506656479: '15self_attn.o_proj', 0.9766587211566038: '23self_attn.o_proj', 0.9891144074988372: '30self_attn.o_proj', 1.0111729753655254: '17self_attn.k_proj', 1.0178567328187862: '20self_attn.k_proj', 1.0317910998817341: '15self_attn.k_proj', 1.0435527810474037: '21self_attn.k_proj', 1.044775676830005: '31self_attn.k_proj', 1.0634523980038209: '10self_attn.o_proj', 1.0979177980594992: '9self_attn.k_proj', 1.133870396866107: '10self_attn.q_proj', 1.1354135396161977: '29self_attn.o_proj', 1.1411209404923577: '9self_attn.q_proj', 1.1602971303335012: '13self_attn.k_proj', 1.161086490091737: '24self_attn.k_proj', 1.1721597148231888: '14self_attn.q_proj', 1.1767714209613631: '21self_attn.o_proj', 1.180196395053585: '15self_attn.q_proj', 1.1810853793272207: '16self_attn.k_proj', 1.1880352601972435: '5self_attn.k_proj', 1.2050832780636744: '18self_attn.o_proj', 1.2059181139601396: '14self_attn.k_proj', 1.2103450390010773: '12self_attn.k_proj', 1.2169989395932497: '19self_attn.o_proj', 1.2275136822563768: '12self_attn.q_proj', 1.2391307395722464: '5self_attn.q_proj', 1.2467150432468772: '13self_attn.q_proj', 1.2597206606073952: '25self_attn.q_proj', 1.2604406701808495: '31self_attn.q_proj', 1.262353252802395: '10self_attn.k_proj', 1.269190067451742: '0mlp.gate_proj', 1.3021622514412137: '8self_attn.k_proj', 1.3309343587341909: '4self_attn.k_proj', 1.331741585407725: '18self_attn.q_proj', 1.3681847684660182: '7self_attn.k_proj', 1.3913518343431885: '14self_attn.o_proj', 1.4023006574799597: '17self_attn.o_proj', 1.41058356494222: '17self_attn.q_proj', 1.4340556320458084: '12self_attn.o_proj', 1.4565139644730838: '27self_attn.q_proj', 1.4752445788067599: '13self_attn.o_proj', 1.478034883058803: '6self_attn.k_proj', 1.501974087132231: '19self_attn.q_proj', 1.5525505415325451: '3self_attn.k_proj', 1.6229730483215237: '23self_attn.q_proj', 1.630848587525195: '11self_attn.k_proj', 1.6504210156825838: '22self_attn.q_proj', 1.7117156949789765: '7self_attn.q_proj', 1.746416094050959: '26self_attn.q_proj', 1.8107966369883153: '24self_attn.q_proj', 1.8256071389116872: '8self_attn.q_proj', 1.8384166345295005: '1self_attn.v_proj', 1.8591558941106827: '6self_attn.q_proj', 1.9032972823651173: '9self_attn.o_proj', 1.9206986159336: '28self_attn.q_proj', 1.9387756507742715: '16self_attn.q_proj', 2.0235006003770657: '21self_attn.q_proj', 2.076595574419752: '4self_attn.q_proj', 2.089448547787887: '20self_attn.q_proj', 2.1078402856205436: '30mlp.down_proj', 2.116813149153919: '11self_attn.q_proj', 2.1587511415076586: '5self_attn.o_proj', 2.347610561393708: '7self_attn.o_proj', 2.404761630435047: '26self_attn.o_proj', 2.422568329046552: '2self_attn.k_proj', 2.747449112728132: '3self_attn.q_proj', 2.75206972772167: '29self_attn.q_proj', 2.794882486073459: '30self_attn.q_proj', 2.845498006156931: '2self_attn.q_proj', 2.993817704977201: '4self_attn.o_proj', 3.007940412405506: '8self_attn.o_proj', 3.1512512579371075: '11self_attn.o_proj', 3.1798823186300504: '0self_attn.v_proj', 3.20978041938933: '20self_attn.o_proj', 3.2800028485636217: '1mlp.gate_proj', 3.397808422117449: '24self_attn.o_proj', 3.7386551320978167: '3self_attn.o_proj', 4.088338485259551: '6self_attn.o_proj', 4.172113174858918: '2self_attn.o_proj', 4.5802935382124135: '1mlp.down_proj', 5.489964918198787: '30mlp.gate_proj', 5.550558646527769: '31mlp.down_proj', 6.506592860422103: '1self_attn.q_proj', 6.524281481179829: '30mlp.up_proj', 6.935371374026081: '1self_attn.k_proj', 9.72973753381282: '22self_attn.o_proj', 23.69787713965271: '1self_attn.o_proj', 35.24344781783628: '0self_attn.k_proj', 35.917877019289406: '31self_attn.o_proj', 36.606632106657415: '0self_attn.o_proj', 67.89063407817052: '0self_attn.q_proj'}

# 386个层
# 386 * 10% = 38.6

def find_key(sorted_dict):
    total_weight = 0.0
    for key, val in sorted_dict.items():
        if any(sub in str(val) for sub in ['gate_proj', 'up_proj', 'down_proj']):
            weight = 2.6875
        else:
            weight = 1
        total_weight += weight
        if total_weight >= 38.6:
            return key, total_weight
    return None, total_weight  # 如果所有键的权重总和仍不足 77.2


key, toal_weight = find_key(sorted_kurt)
print(key)
print(toal_weight)
print('--------------------')
down_sorted_kurt = {k: sorted_kurt[k] for k in sorted(sorted_kurt.keys(), reverse=True)}
key, toal_weight = find_key(down_sorted_kurt)
print(key)
print(toal_weight)

# roubost 34 {0.02096672136220734: '24mlp.up_proj', 0.026070663498454216: '22mlp.up_proj', 0.026151729884150043: '25mlp.up_proj', 0.029466900689183895: '23mlp.up_proj', 0.030696840246880353: '26mlp.up_proj', 0.03173594348243025: '21mlp.up_proj', 0.03293751666766287: '27mlp.up_proj', 0.037644738477705: '20mlp.up_proj', 0.045221148790187016: '22mlp.down_proj', 0.045774527398766196: '28mlp.up_proj', 0.04753815202167644: '18mlp.up_proj', 0.05398357984897961: '17mlp.up_proj', 0.06439268315669677: '2mlp.up_proj', 0.0757519740562933: '12mlp.up_proj', 0.07692631709511977: '19mlp.up_proj', 0.07732927133231815: '20self_attn.v_proj', 0.07960574558775058: '16mlp.up_proj', 0.08253144500009446: '25self_attn.v_proj', 0.08591864636608859: '7mlp.up_proj', 0.0875280255068498: '24self_attn.v_proj', 0.08838672097505595: '14mlp.up_proj', 0.09141451415031554: '21self_attn.v_proj', 0.09344239470000959: '26mlp.down_proj', 0.09416433004200675: '10mlp.up_proj', 0.09420727397064432: '27self_attn.v_proj', 0.09970998218644755: '13mlp.up_proj', 0.10186981503229475: '23self_attn.v_proj', 0.10289971635381123: '22self_attn.v_proj', 0.10315499579797693: '4mlp.up_proj', 0.10360805801621176: '15mlp.up_proj', 0.10748665074720876: '5mlp.up_proj', 0.11035153914889628: '6mlp.up_proj', 0.1136330829660479: '29self_attn.v_proj', 0.11512561508148877: '11mlp.up_proj'}
# sensivity 66 {1.2391307395722464: '5self_attn.q_proj', 1.2467150432468772: '13self_attn.q_proj', 1.2597206606073952: '25self_attn.q_proj', 1.2604406701808495: '31self_attn.q_proj', 1.262353252802395: '10self_attn.k_proj', 1.269190067451742: '0mlp.gate_proj', 1.3021622514412137: '8self_attn.k_proj', 1.3309343587341909: '4self_attn.k_proj', 1.331741585407725: '18self_attn.q_proj', 1.3681847684660182: '7self_attn.k_proj', 1.3913518343431885: '14self_attn.o_proj', 1.4023006574799597: '17self_attn.o_proj', 1.41058356494222: '17self_attn.q_proj', 1.4340556320458084: '12self_attn.o_proj', 1.4565139644730838: '27self_attn.q_proj', 1.4752445788067599: '13self_attn.o_proj', 1.478034883058803: '6self_attn.k_proj', 1.501974087132231: '19self_attn.q_proj', 1.5525505415325451: '3self_attn.k_proj', 1.6229730483215237: '23self_attn.q_proj', 1.630848587525195: '11self_attn.k_proj', 1.6504210156825838: '22self_attn.q_proj', 1.7117156949789765: '7self_attn.q_proj', 1.746416094050959: '26self_attn.q_proj', 1.8107966369883153: '24self_attn.q_proj', 1.8256071389116872: '8self_attn.q_proj', 1.8384166345295005: '1self_attn.v_proj', 1.8591558941106827: '6self_attn.q_proj', 1.9032972823651173: '9self_attn.o_proj', 1.9206986159336: '28self_attn.q_proj', 1.9387756507742715: '16self_attn.q_proj', 2.0235006003770657: '21self_attn.q_proj', 2.076595574419752: '4self_attn.q_proj', 2.089448547787887: '20self_attn.q_proj', 2.1078402856205436: '30mlp.down_proj', 2.116813149153919: '11self_attn.q_proj', 2.1587511415076586: '5self_attn.o_proj', 2.347610561393708: '7self_attn.o_proj', 2.404761630435047: '26self_attn.o_proj', 2.422568329046552: '2self_attn.k_proj', 2.747449112728132: '3self_attn.q_proj', 2.75206972772167: '29self_attn.q_proj', 2.794882486073459: '30self_attn.q_proj', 2.845498006156931: '2self_attn.q_proj', 2.993817704977201: '4self_attn.o_proj', 3.007940412405506: '8self_attn.o_proj', 3.1512512579371075: '11self_attn.o_proj', 3.1798823186300504: '0self_attn.v_proj', 3.20978041938933: '20self_attn.o_proj', 3.2800028485636217: '1mlp.gate_proj', 3.397808422117449: '24self_attn.o_proj', 3.7386551320978167: '3self_attn.o_proj', 4.088338485259551: '6self_attn.o_proj', 4.172113174858918: '2self_attn.o_proj', 4.5802935382124135: '1mlp.down_proj', 5.489964918198787: '30mlp.gate_proj', 5.550558646527769: '31mlp.down_proj', 6.506592860422103: '1self_attn.q_proj', 6.524281481179829: '30mlp.up_proj', 6.935371374026081: '1self_attn.k_proj', 9.72973753381282: '22self_attn.o_proj', 23.69787713965271: '1self_attn.o_proj', 35.24344781783628: '0self_attn.k_proj', 35.917877019289406: '31self_attn.o_proj', 36.606632106657415: '0self_attn.o_proj', 67.89063407817052: '0self_attn.q_proj'}